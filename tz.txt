Приложение склад

Таблицы:

Артикул(VendorCode)
id
vendorCode
description

Приход(outpuwaybill)
id
number
status(CREATED,COMPLETED,FAILED)

Позиции прихода(InputPos)
id
iw_id(накладная)
vc_id(артикул)
qty(количество) 

Склад
id
vc_id
qty(если несколько позиций с одним артикулом, то складываем)


Расход(outpuwaybill)
id
number
status(CREATED,COMPLETED,FAILED)

Позиции расхода(OutputPos)
id
ow_id(накладная)
vc_id(артикул)
qty(количество) 


Задача:
Автоматизировать склад
Есть два приложения:
склад, пользователь склада
пользователь рандомно посылает накладные на прием товара, и получение этого товара
склад принимает товар по накладным и выдает его по мере возможностей

Приложение пользователь склада:

Процесс0(пополнение справочника артикулов)
При старте клиентского приложения отправляются все известные артикула


Процесс1(передача на хранение):
Периодически(интервалы времени не регламентированы) создает накладные на прием(номер состоит из 10 цифр, увеличивается, не более 3 позиций артикулов, количество до 1000)
отправляет накладную в формате json складу(описан ниже)
по факту подтверждения приема запроса считает, что товар принят на склад

Процесс2(Снятие с хранения):
Периодически(интервалы времени не регламентированы) создает накладные на выдачу(номер состоит из 10 цифр, увеличивается, не более 3 позиций артикулов, количество до 100)
отправляет накладную в формате json складу(описан ниже)
по факту подтверждения приема запроса считает, что товар выдан со склада

Приложение склад:

Процесс3(Прием на хранение):
При получении вызова клиента на прием накладной, записывает приходную накладную в свою таблицу, позиции в свою.
Приходная накладная создается со статусом CREATED. Клиенту возвращается 200. 
Раз в минуту происходит процесс приема товаров из созданных накладных на склад.  
Добавляет к товарам на складе пришедшее количество соответственно артикулам, если происходит ошибка на одном из этапов, то все товары по накладной из складской таблицы  удалить, накладную перевести в статус FAILED.  в случае успешного завершения накладную перевести в статус COMPLETED

Процесс4(Списание):
Аналогичен приемке? только товар списывается, если количество в итоге равно 0, то позиция удаляется. В случае, если количества товара на хранении не хватает, переводить накладную в статус FAILED.









